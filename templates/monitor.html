{% extends 'base.html' %}
{% block content %}
    <div>
        <h1>MONITOR</h1>
        <p>Connections: <span id="connections">?</span></p>

        <div id="clients">

        </div>
    </div>

    <script type="text/javascript">
        let socket = io();
        const connectionsElement = document.querySelector('#connections');
        const clientsElement = document.querySelector('#clients');

        socket.on('client_connected', (amount) => {
            connectionsElement.innerText = amount;
        });

        socket.on('identify', (data) => {
            let clientElement = document.createElement('p');
            clientElement.id = "client-" + data;
            clientElement.innerText = data['username'];
            clientElement.addEventListener('click', async (event) => {
                socket.emit('kick', data['username']);
            });
            clientsElement.append(clientElement);
        });

        socket.on('client_disconnected', (amount, name) => {
            connectionsElement.innerText = amount;
            document.getElementById('client-' + name).remove();
        });
    </script>
{% endblock %}